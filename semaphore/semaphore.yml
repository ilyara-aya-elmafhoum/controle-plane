blocks:
  - name: Terraform Apply
    task:
      env_vars:
        - name: TF_VAR_openstack_cloud
          value: $OPENSTACK_CLOUD_SECRET
        - name: TF_VAR_OS_USERNAME
          value: $OS_USERNAME_SECRET
        - name: TF_VAR_OS_PASSWORD
          value: $OS_PASSWORD_SECRET
        - name: TF_VAR_OS_PROJECT_NAME
          value: $OS_PROJECT_NAME_SECRET
        - name: TF_VAR_OS_auth_url
          value: $OS_AUTH_URL_SECRET
        - name: TF_VAR_sysadmin_pub_key
          value: $SYSADMIN_PUB_KEY_SECRET
        - name: TF_VAR_devops_aya_pub_key
          value: $DEVOPS_AYA_PUB_KEY_SECRET
        - name: TF_VAR_terraform_bot_pub_key
          value: $TERRAFORM_BOT_PUB_KEY_SECRET
        - name: TF_VAR_vm_flavor
          value: $VM_FLAVOR_SECRET
        - name: TF_VAR_vm_image
          value: $VM_IMAGE_SECRET
        - name: TF_VAR_floating_ip_pool
          value: $FLOATING_IP_POOL_SECRET
        - name: TF_VAR_admin_cidr
          value: $ADMIN_CIDR_SECRET
      jobs:
        - name: Create control-plane
          commands:
            - checkout
            - cd repository_1_template_1/terraform
            - echo "Debug: VÃ©rification des variables TF_VAR_"
            - env | grep TF_VAR_
            - terraform init -input=false
            - terraform plan -input=false
            - terraform apply -auto-approve -input=false
            - terraform output -raw controle_plane_ip > ../ansible/control_plane_ip.txt
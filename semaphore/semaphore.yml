blocks:
  - name: Terraform Apply
    task:
      variable_groups:
        - name: terraform-variabls  
      jobs:
        - name: Create control-plane
          commands:
            - echo "Export des variables Terraform"
            - export TF_VAR_openstack_cloud=$OPENSTACK_CLOUD
            - export TF_VAR_OS_USERNAME=$OS_USERNAME
            - export TF_VAR_OS_PASSWORD=$OS_PASSWORD
            - export TF_VAR_OS_PROJECT_NAME=$OS_PROJECT_NAME
            - export TF_VAR_OS_auth_url=$OS_AUTH_URL
            - export TF_VAR_sysadmin_pub_key="$SYSADMIN_PUB_KEY"
            - export TF_VAR_devops_aya_pub_key="$DEVOPS_AYA_PUB_KEY"
            - export TF_VAR_terraform_bot_pub_key="$TERRAFORM_BOT_PUB_KEY"
            - export TF_VAR_vm_flavor=$VM_FLAVOR
            - export TF_VAR_vm_image=$VM_IMAGE
            - export TF_VAR_floating_ip_pool=$FLOATING_IP_POOL
            - export TF_VAR_admin_cidr=$ADMIN_CIDR

            - cd repository_1_template_1/terraform
            - terraform init -input=false
            - terraform plan -input=false
            - terraform apply -auto-approve -input=false
            - terraform output -raw controle_plane_ip > ../ansible/control_plane_ip.txt
